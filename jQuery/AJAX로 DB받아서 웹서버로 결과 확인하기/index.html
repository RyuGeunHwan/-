<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      .container {
        width: 1200px;
        margin: 50px auto;
      }
      .emp-table {
        width: 100%;
        height: 400px;
        box-shadow: 0 3px 7px grey;
        background-color: #ffffff;
      }
      tr {
        border: 1px solid #444444;
      }
      tr:nth-child(even) {
        background-color: #eaeaeb;
      }
      thead {
        box-shadow: 0 1px 5px grey;
      }
      th {
        padding: 1rem 2rem;
        letter-spacing: 0.4rem;
        font-size: 16px;
        font-weight: 800;
        text-align: center;
      }
      td {
        font-size: 14px;
        padding: 1rem 2rem;
        text-align: center;
      }
      h1 {
        text-align: center;
        margin-bottom: 50px;
      }
      a {
        cursor: pointer;
      }
      button{
          margin: 50px auto;
          text-align: center;
          padding: 20px 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 id="empList">사원리스트</h1>
      <table class="emp-table">
            <thead>
            <tr>
                <th>사원 번호</th>
                <th>부서 번호</th>
                <th>사원 이름</th>
                <th>직업</th>
                <th>급여</th>
                <th>입사 날짜</th>
                <th>부서 이름</th>
                <th>근무 지역</th>
            </tr>
            </thead>
            <tbody id="data"></tbody>
        </table>
        <button id="btn" type="button">사원 추가</button>
        <button id="btn-update" type="button">사원 수정</button>
    </div>
    </body>
    <!-- jquery download -->
    <!-- AJAX는 jquery에 있는 기능(함수) -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script>
        //사원 조회
      $.ajax({
        url: 'http://localhost:8080/emp',
        type: 'GET',
        dataType: 'json',
        success: function (response) {
          //response : 변수이름이다.
          // 데이터 요청이 성공한다면 success함수가 실행 된다.
          var count = 0;
          for(var i=0; i<response.length; i++){
              if(response[i].deptno == 30){
                count++;
            }
          }
          console.log(count)
          getDeptnoCount(response);
        },
        error: function (request, status, error) {
          // 데이터 요청에 실패한다면 error함수가 실행된다.
          // error가 변수(error)에 들어온다.
          console.log('에러 내용 : ' + error);
        },
      });

      // 조회한 사원을 게시판에 추가!
      function getDeptnoCount(response) {
        let html = '';
        for (var i = 0; i < response.length; i++) {
          html +=
            '<tr><td><a onclick=removeEmp(' + //onclick=removeEmp(파라미터 값) : ''안에 있어도 html이라고 생각하면 된다.
            response[i].empno +
            ')>' +
            response[i].empno +
            '</a></td><td>' +
            response[i].deptno +
            '</td><td>' +
            response[i].ename +
            '</td><td>' +
            response[i].job +
            '</td><td>' +
            response[i].sal +
            '</td><td>' +
            response[i].hiredate +
            '</td><td>' +
            response[i].dname +
            '</td><td>' +
            response[i].loc +
            '</td></tr>';
        }
        $('#data').append(html);
      }

      //사원 삭제
      function removeEmp(empNo) {
        if (confirm('정말로 사원을 삭제하시겠습니까?')) {
          $.ajax({
            url: 'http://localhost:8080/emp/empno/' + empNo,
            type: 'DELETE',
            dataType: 'json',
            success: function (response) {
              console.log(response);

              // 클릭해서 지웠으니까 새로고침을 해주어야함.
              location.reload();
            },
            error: function (request, status, error) {
              console.log(error);
            },
          });
        }
      }

      //사원 추가
      $('#btn').click(function () {
          let jsonData = {
            "empno" : 8045,
            "ename" : "삼각발",
            "deptno" : 20,
             "sal" : 150,
             "job" : "프리랜서"
          };
          $.ajax({
            url: 'http://localhost:8080/emp',
            type: 'POST',
            contentType: 'application/json', // contentType : 서버에게 json으로 요청한다.
            dataType: 'json', //dataType : 서버의 결과를 json으로 응답 받는다. 
            data: JSON.stringify(jsonData), // data : JSON.stringify(json을 담은 변수명)을 안해주면 json을 문자로 인식 <-> 해주면 json으로 인식
            success: function (response) {
              console.log(response);
              location.reload();
            },
            error: function (request, status, error) {
              console.log(error);
            },
          });
        });
        
      //사원 수정
      $('#btn-update').click(function(){
        let jsonData = {
            "job" : "MANAGER",
            "sal" : 2500
          };
          let empno = 7902;
          $.ajax({
            url: 'http://localhost:8080/api/v1/emp/'+empno, // controller 주소, 웹 출력시 수정하고자 하는 empno 헤더에 작성
            type: 'PATCH', //HTTP 메소드 (GET,POST,DELETE,PATCH)
            contentType: 'application/json', //contentType : controller에 요청할 때 json 으로 보냄.
            dataType: 'json', //dataType : controller에요청한 데이터를 json으로 응답받는다.
            data: JSON.stringify(jsonData), //JSON.stringify을 안해주면 json을 문자로 인식
            success: function (response) {
              console.log(response);
              location.reload();
            },
            error: function (request, status, error) {
              console.log(error);
            },
          });
      });


    </script>
</html>
